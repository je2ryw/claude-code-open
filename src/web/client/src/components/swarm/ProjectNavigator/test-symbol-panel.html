<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¦å·è¯¦æƒ…é¢æ¿æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #1e1e1e;
      color: #ffffff;
      padding: 20px;
    }

    h1 {
      margin-bottom: 20px;
      color: #2196f3;
    }

    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .test-links {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #2d2d2d;
      border-radius: 8px;
    }

    .test-links h2 {
      margin-bottom: 16px;
      font-size: 18px;
    }

    .test-links ul {
      list-style: none;
    }

    .test-links li {
      margin-bottom: 12px;
    }

    .test-links a {
      display: inline-block;
      padding: 8px 16px;
      background-color: #2196f3;
      color: #ffffff;
      text-decoration: none;
      border-radius: 4px;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .test-links a:hover {
      background-color: #0b7dda;
    }

    .symbol-panel-container {
      width: 500px;
      height: 80vh;
      background-color: #1e1e1e;
      border: 2px solid #3d3d3d;
      border-radius: 8px;
      overflow: hidden;
    }

    .info {
      margin-top: 20px;
      padding: 16px;
      background-color: rgba(33, 150, 243, 0.1);
      border: 1px solid rgba(33, 150, 243, 0.3);
      border-radius: 4px;
      font-size: 14px;
      color: #4fc3f7;
    }

    .info code {
      background-color: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Consolas', monospace;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ” ç¬¦å·è¯¦æƒ…é¢æ¿ç»„ä»¶æµ‹è¯•</h1>

    <div class="test-links">
      <h2>æµ‹è¯•ç”¨ä¾‹</h2>
      <ul>
        <li>
          <a href="#" onclick="testSymbol('src/blueprint/blueprint-manager.ts::BlueprintManager'); return false;">
            æµ‹è¯• 1: ç±» (BlueprintManager)
          </a>
        </li>
        <li>
          <a href="#" onclick="testSymbol('src/blueprint/blueprint-manager.ts::BlueprintManager::createFromRequirement'); return false;">
            æµ‹è¯• 2: æ–¹æ³• (createFromRequirement)
          </a>
        </li>
        <li>
          <a href="#" onclick="testSymbol('src/web/server/routes/symbol-classifier.ts::classifySymbol'); return false;">
            æµ‹è¯• 3: å‡½æ•° (classifySymbol)
          </a>
        </li>
        <li>
          <a href="#" onclick="testSymbol('src/web/server/routes/symbol-classifier.ts::SymbolClassification'); return false;">
            æµ‹è¯• 4: æ¥å£ (SymbolClassification)
          </a>
        </li>
        <li>
          <a href="#" onclick="testSymbol('src/web/server/routes/symbol-classifier.ts::ViewType'); return false;">
            æµ‹è¯• 5: ç±»å‹æšä¸¾ (ViewType)
          </a>
        </li>
      </ul>
    </div>

    <div id="panel-root" class="symbol-panel-container"></div>

    <div class="info">
      <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
      ç‚¹å‡»ä¸Šæ–¹æµ‹è¯•é“¾æ¥ï¼ŒæŸ¥çœ‹ä¸åŒç¬¦å·ç±»å‹çš„è¯¦æƒ…é¢æ¿æ¸²æŸ“æ•ˆæœã€‚<br>
      ç¬¦å· ID æ ¼å¼ï¼š<code>file.ts::symbolName</code> æˆ– <code>file.ts::ClassName::methodName</code>
    </div>
  </div>

  <script>
    function testSymbol(symbolId) {
      console.log('[Test] Loading symbol:', symbolId);

      // æ¸…ç©ºå®¹å™¨
      const container = document.getElementById('panel-root');
      container.innerHTML = '<p style="padding: 20px; text-align: center; color: #808080;">åŠ è½½ä¸­...</p>';

      // æ¨¡æ‹Ÿè°ƒç”¨ API
      fetch(`/api/blueprint/symbol-detail?id=${encodeURIComponent(symbolId)}`)
        .then(r => {
          if (!r.ok) {
            throw new Error(`HTTP ${r.status}: ${r.statusText}`);
          }
          return r.json();
        })
        .then(data => {
          console.log('[Test] Response:', data);

          if (data.success) {
            // æ˜¾ç¤ºç»“æœ
            const detail = data.data;
            container.innerHTML = `
              <div style="padding: 20px; color: #ffffff;">
                <h3>${detail.name}</h3>
                <p>ç±»å‹: ${detail.symbolType}</p>
                <p>åˆ†ç±»: ${detail.classification.description}</p>
                <p>é»˜è®¤è§†å›¾: ${detail.classification.defaultView}</p>
                <p>æ”¯æŒçš„è§†å›¾: ${detail.classification.supportedViews.join(', ')}</p>
                <pre style="margin-top: 12px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 4px; font-size: 12px; overflow-x: auto;">${JSON.stringify(detail, null, 2)}</pre>
              </div>
            `;
          } else {
            container.innerHTML = `<p style="padding: 20px; text-align: center; color: #f44336;">é”™è¯¯: ${data.error}</p>`;
          }
        })
        .catch(err => {
          console.error('[Test] Error:', err);
          container.innerHTML = `<p style="padding: 20px; text-align: center; color: #f44336;">åŠ è½½å¤±è´¥: ${err.message}</p>`;
        });
    }

    // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
    window.addEventListener('load', () => {
      testSymbol('src/blueprint/blueprint-manager.ts::BlueprintManager');
    });
  </script>
</body>
</html>
