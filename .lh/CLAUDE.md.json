{
    "sourceFile": "CLAUDE.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1768312391994,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768312537636,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n 你的编程搭档是中国人，记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n 官方源码路径：`node_modules\\@anthropic-ai\\claude-code`\r\n docs 文档统一保存路径\r\n tests 测试用例统一保存路径\r\n-## 你是一个高级软件产品经理，设计产品的时候一切以方便用户为核心理念，抛弃程序员思维\r\n+## 你是一个高级软件产品经理，设计产品的时候一切以方便用户为核心理念，抛弃程序员思维，完成编码不是最终目的\r\n ## Project Overview\r\n \r\n This is an educational reverse-engineering project that recreates Claude Code CLI v2.1.4. It's a TypeScript-based terminal application that provides an AI assistant with 25+ tools for file operations, code analysis, web access, and system commands.\r\n \r\n"
                },
                {
                    "date": 1768312938745,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n # CLAUDE.md\r\n \r\n This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\r\n 你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，\r\n-你的编程搭档是中国人，记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n+记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n 官方源码路径：`node_modules\\@anthropic-ai\\claude-code`\r\n docs 文档统一保存路径\r\n tests 测试用例统一保存路径\r\n ## 你是一个高级软件产品经理，设计产品的时候一切以方便用户为核心理念，抛弃程序员思维，完成编码不是最终目的\r\n"
                },
                {
                    "date": 1768384046088,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,13 @@\n # CLAUDE.md\r\n \r\n This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\r\n-你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，\r\n+你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，禁止写todo\r\n 记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n 官方源码路径：`node_modules\\@anthropic-ai\\claude-code`\r\n docs 文档统一保存路径\r\n tests 测试用例统一保存路径\r\n+\r\n ## 你是一个高级软件产品经理，设计产品的时候一切以方便用户为核心理念，抛弃程序员思维，完成编码不是最终目的\r\n ## Project Overview\r\n \r\n This is an educational reverse-engineering project that recreates Claude Code CLI v2.1.4. It's a TypeScript-based terminal application that provides an AI assistant with 25+ tools for file operations, code analysis, web access, and system commands.\r\n"
                },
                {
                    "date": 1768384083552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n # CLAUDE.md\r\n \r\n This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\r\n-你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，禁止写todo\r\n+你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，禁止写todo，直接实现功能\r\n 记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n 官方源码路径：`node_modules\\@anthropic-ai\\claude-code`\r\n docs 文档统一保存路径\r\n tests 测试用例统一保存路径\r\n"
                }
            ],
            "date": 1768312391994,
            "name": "Commit-0",
            "content": "# CLAUDE.md\r\n\r\nThis file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\r\n你是超级软件黑客，最擅长逆向工程混淆的过的代码，每次都出方案后，都要重新思考一下这个有什么缺点，每个方案都要思考三遍，三思而后行，不要急于求成，\r\n你的编程搭档是中国人，记得用中文回复，永远不要增加降级方案，遇到问题直接报错，当前项目是一个复刻还原项目，当你遇到解决不了的难题的时候，请直接copy官网的实现的源码，使用第一性原理解决问题，不要掩盖问题，禁止猜测官网的实现方式，必须找到相关实现的源码，然后copy实现，\r\n官方源码路径：`node_modules\\@anthropic-ai\\claude-code`\r\ndocs 文档统一保存路径\r\ntests 测试用例统一保存路径\r\n## 你是一个高级软件产品经理，设计产品的时候一切以方便用户为核心理念，抛弃程序员思维\r\n## Project Overview\r\n\r\nThis is an educational reverse-engineering project that recreates Claude Code CLI v2.1.4. It's a TypeScript-based terminal application that provides an AI assistant with 25+ tools for file operations, code analysis, web access, and system commands.\r\n\r\n\r\n**Important:** This is NOT the official Claude Code source - it's a learning project based on public APIs and type definitions. 后续CLI 版本的代码都不维护了，以后调整代码只调整WebUI的，遇到不确定性改进的时候的，只有一个准则，保持官网一致，不要有讨好型人格，要有批判性思维，并有敢于探索世界性难题的勇气\r\n\r\n## Development Commands\r\n\r\n```bash\r\n# Development mode (live TypeScript execution)\r\nnpm run dev\r\n\r\n# Build TypeScript to dist/\r\nnpm run build\r\n\r\n# Run compiled version\r\nnpm run start  # or: node dist/cli.js\r\n\r\n# Type checking without compiling\r\nnpx tsc --noEmit\r\n```\r\n\r\n### Testing\r\n\r\n```bash\r\nnpm test                    # Run all tests (vitest)\r\nnpm run test:unit           # Unit tests only (src/)\r\nnpm run test:integration    # Integration tests (tests/integration/)\r\nnpm run test:e2e            # End-to-end CLI tests\r\nnpm run test:coverage       # Run with coverage report\r\nnpm run test:watch          # Watch mode\r\nnpm run test:ui             # Vitest UI\r\n```\r\n\r\n### CLI Usage\r\n\r\n```bash\r\nnode dist/cli.js                        # Interactive mode\r\nnode dist/cli.js \"Analyze this code\"    # With initial prompt\r\nnode dist/cli.js -p \"Explain this\"      # Print mode (non-interactive)\r\nnode dist/cli.js -m opus \"Complex task\" # Specify model (opus/sonnet/haiku)\r\nnode dist/cli.js --resume               # Resume last session\r\n```\r\n\r\n## Architecture Overview\r\n\r\n### Core Three-Layer Design\r\n\r\n1. **Entry Layer** (`src/cli.ts`, `src/index.ts`)\r\n   - CLI argument parsing with Commander.js\r\n   - Main export barrel file\r\n\r\n2. **Core Engine** (`src/core/`)\r\n   - `client.ts` - Anthropic API wrapper with retry logic, token counting, cost calculation\r\n   - `session.ts` - Session state management, message history, cost tracking\r\n   - `loop.ts` - Main conversation orchestrator, handles tool filtering and multi-turn dialogues\r\n\r\n3. **Tool System** (`src/tools/`)\r\n   - All tools extend `BaseTool` and register in `ToolRegistry`\r\n   - 25+ tools: Bash, Read, Write, Edit, MultiEdit, Glob, Grep, WebFetch, WebSearch, TodoWrite, Task, NotebookEdit, MCP, Tmux, Skills, etc.\r\n\r\n### Key Data Flow\r\n\r\n```\r\nCLI Input → ConversationLoop → ClaudeClient (Anthropic API)\r\n                ↓                      ↓\r\n           ToolRegistry           Session State\r\n                ↓                      ↓\r\n          Tool Execution    Session Persistence (~/.claude/sessions/)\r\n```\r\n\r\n### Important Subsystems\r\n\r\n- **Session Management** (`src/session/`) - Persists conversations to `~/.claude/sessions/` with 30-day expiry\r\n- **Configuration** (`src/config/`) - Loads from `~/.claude/settings.json` and environment variables\r\n- **Context Management** (`src/context/`) - Token estimation, auto-summarization when hitting limits\r\n- **Hooks System** (`src/hooks/`) - Pre/post tool execution hooks for customization\r\n- **Plugin System** (`src/plugins/`) - Extensible plugin architecture\r\n- **UI Components** (`src/ui/`) - React + Ink terminal UI framework\r\n- **Code Parser** (`src/parser/`) - Tree-sitter WASM for multi-language parsing\r\n- **Ripgrep** (`src/search/ripgrep.ts`) - Vendored ripgrep binary support\r\n- **Streaming I/O** (`src/streaming/`) - JSON message streaming for Claude API\r\n\r\n## Tool System Architecture\r\n\r\nTools are the core of the application. Each tool:\r\n1. Extends `BaseTool` class\r\n2. Defines input schema with Zod\r\n3. Implements `execute()` method\r\n4. Registers in `ToolRegistry`\r\n5. Can be filtered via allow/disallow lists\r\n\r\nTools communicate results back to the conversation loop, which feeds them to the Claude API for the next turn.\r\n\r\n## Configuration\r\n\r\n### Locations (Linux/macOS: `~/.claude/`, Windows: `%USERPROFILE%\\.claude\\`)\r\n\r\n- **API Key:** `ANTHROPIC_API_KEY` or `CLAUDE_API_KEY` env var, or `settings.json`\r\n- **Sessions:** `sessions/` directory (JSON files, 30-day expiry)\r\n- **MCP Servers:** Defined in `settings.json`\r\n- **Skills:** `~/.claude/skills/` and `./.claude/commands/`\r\n- **Plugins:** `~/.claude/plugins/` and `./.claude/plugins/`\r\n\r\n### Key Environment Variables\r\n\r\n- `ANTHROPIC_API_KEY` / `CLAUDE_API_KEY` - API key for Claude\r\n- `USE_BUILTIN_RIPGREP` - Set to `1`/`true` to use system ripgrep instead of vendored\r\n- `BASH_MAX_OUTPUT_LENGTH` - Max Bash output length (default: 30000)\r\n- `CLAUDE_CODE_MAX_OUTPUT_TOKENS` - Max output tokens (default: 32000)\r\n\r\n### Windows-Specific Notes\r\n\r\n- Bubblewrap sandbox: Linux-only (Windows needs WSL)\r\n- Tmux: Linux/macOS only (use Windows Terminal tabs/panes)\r\n- Hook scripts: Use `.bat` or `.ps1` instead of `.sh`\r\n- JSON paths: Use double backslashes (e.g., `\"C:\\\\Users\\\\user\\\\projects\"`)\r\n\r\n## Key Design Patterns\r\n\r\n- **Registry Pattern** - `ToolRegistry` for dynamic tool management\r\n- **Plugin Pattern** - `PluginManager` with lifecycle hooks\r\n- **Strategy Pattern** - Multiple permission modes (acceptEdits, bypassPermissions, plan)\r\n- **Observer Pattern** - Event-driven hook system\r\n\r\n## TypeScript Configuration\r\n\r\n- **Target:** ES2022, **Module:** NodeNext (ES Modules)\r\n- **JSX:** React (for Ink UI components)\r\n- **Output:** `dist/` with source maps and declarations\r\n- **Strict:** Disabled (`\"strict\": false`)\r\n"
        }
    ]
}